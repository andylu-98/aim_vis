<!DOCTYPE html>
<html>
<head>
<script>

var distanceMatrix = []; 
var data = 
[	[	20833.3333	,	17100	],	
	[	20900	,	17066.6667	],	
	[	21300	,	13016.6667	],	
	[	21600	,	14150	],	
	[	21600	,	14966.6667	],	
	[	21600	,	16500	],	
	[	22183.3333	,	13133.3333	],	
	[	22583.3333	,	14300	],	
	[	22683.3333	,	12716.6667	],	
	[	23616.6667	,	15866.6667	],	
	[	23700	,	15933.3333	],	
	[	23883.3333	,	14533.3333	],	
	[	24166.6667	,	13250	],	
	[	25149.1667	,	12365.8333	],	
	[	26133.3333	,	14500	],	
	[	26150	,	10550	],	
	[	26283.3333	,	12766.6667	],	
	[	26433.3333	,	13433.3333	],	
	[	26550	,	13850	],	
	[	26733.3333	,	11683.3333	],	
	[	27026.1111	,	13051.9444	],	
	[	27096.1111	,	13415.8333	],	
	[	27153.6111	,	13203.3333	],	
	[	27166.6667	,	9833.3333	],	
	[	27233.3333	,	10450	],	
	[	27233.3333	,	11783.3333	],	
	[	27266.6667	,	10383.3333	],	
	[	27433.3333	,	12400	],	
	[	27462.5	,	12992.2222	]	];



function EuclideanDistance(x1,y1,x2,y2){
  return Math.round(Math.sqrt( Math.pow((x1-x2),2) + Math.pow((y1-y2),2) ));
}

function dist(){
  for (var i = 0; i < data.length; i++){
    var arr = [];
    for (var j = 0; j < data.length; j++){
      arr.push( EuclideanDistance(data[i][0], data[i][1],data[j][0], data[j][1]) );
    };
    distanceMatrix.push(arr);
  };
}

function totalDistance(tour){
  var tmpDist = 0.0;
  for (var j = 1; j < data.length; j++)
    tmpDist += parseInt(distanceMatrix[tour[j-1]][tour[j]]);
  tmpDist += parseInt(distanceMatrix[tour[data.length-1]][tour[0]]);
  return tmpDist;
}

// inclusive min,max
function getRndInteger(min, max) {
    return Math.floor(Math.random() * (max - min + 1) ) + min;
}

function getStringTour(tour){
 var locTxt="";
 for (var i = 0; i < tour.length-1; i++)
   locTxt += tour[i] + ",";
 locTxt += tour[tour.length-1];
 return locTxt;
}


function applyRandomMutationHC(){

dist();

var numberOfPasses = 1;
var currentSolution = [];
var currentSolutionDistance;
var newSolutionDistance;
var tmp;
var txt="";
var loc;
var loc2;
var displayDetails = true;

// create a random permutation 
for (var i = 0; i < data.length; i++)
  currentSolution.push(i);
for (var i = 0; i < data.length-1; i++){
  loc = getRndInteger(i+1, data.length-1); // random location (i,maxLength)
  tmp = currentSolution[i];
  currentSolution[i] = currentSolution[loc];
  currentSolution[loc] = tmp;
}

currentSolutionDistance = totalDistance(currentSolution);  

txt+="Initial solution: "+getStringTour(currentSolution)+": "+currentSolutionDistance+"<p></p>";

for (var k = 0; k < numberOfPasses; k++){
	if (displayDetails) txt+="Pass#"+k+"<br/>";
	// applying hill climbing for one pass
	for (var i = 0; i < data.length; i++){

	  // MAKE MOVE: random swap forming a new solution from current solution
	  loc = getRndInteger(0, data.length-1); 
	  loc2 = getRndInteger(1, data.length-1); 
	  if (loc==loc2){ loc2 = loc2+1; if (loc2==data.length) loc2=0;}; 
	  tmp = currentSolution[loc];
	  currentSolution[loc] = currentSolution[loc2];
	  currentSolution[loc2] = tmp;
	  
	  newSolutionDistance = totalDistance(currentSolution);
	  
	  if (newSolutionDistance < currentSolutionDistance){ // improving move
		if (displayDetails) txt+= "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" +getStringTour(currentSolution)+": "+newSolutionDistance+"<br/>";  
		currentSolutionDistance = newSolutionDistance;
	  } else{ //swap back to the original configuration if the move is not an improving move
		if (displayDetails) txt+=  getStringTour(currentSolution)+": "+newSolutionDistance+"<br/>";
		tmp = currentSolution[loc2];
		currentSolution[loc2] = currentSolution[loc];
		currentSolution[loc] = tmp;
	  }
	}
	if (displayDetails) txt+="End of Pass#"+k + ". Best tour length (travelling distance): "+ currentSolutionDistance+"<p></p>";
}

document.getElementById("demo").innerHTML = "Known optimal tour length (travelling distance) for Western Sahara TSP problem instance with 29 cities (WI29) is ~27603 <br/> <img width=\"400\" src=\"http:\/\/www.cs.nott.ac.uk\/~pszeo\/teaching\/javaScript\/G52AIM\/WI29optimal.jpg\"/><br/>Number of RMHC passes: " + numberOfPasses +"<br/>Best tour found by RMHC: " + getStringTour(currentSolution) +"<br/> Best tour length (travelling distance): "+ currentSolutionDistance +"<p></p>Searched States (Configurations, Solutions):<br/>"+ txt;

}

</script>
</head>

<body>

<h1>Exercise - Random Mutation Hill Climbing (RMHC)</h1>
<button type="button" onclick="applyRandomMutationHC()">Run the algorithm</button>
<p id="demo">Apply random permutation hill climbing for a number of passes over a randomly created initial solution to the given <a href="http://www.math.uwaterloo.ca/tsp/world/countries.html">Western Sahara TSP problem instance</a> with 29 cities (Experiments are not repeatable). Any improving solution has a tab with a few spaces as a prefix. <br/>You can edit the JavaScript code in this HTML file for experimentation, e.g., you can change the number of passes (search for 'numberOfPasses') to try out different values.
<br/>
<img width="400" src="http://www.cs.nott.ac.uk/~pszeo/teaching/javaScript/G52AIM/WI29.jpg"/>
</p>


</body>
</html>