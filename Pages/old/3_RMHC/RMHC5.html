<!DOCTYPE html>
<html>
<head>
<script>

var distanceMatrix = []; 
var data = 
[[	1.309016994	,	1.951056516	],
[	0.190983006	,	1.587785252	],
[	0.190983006	,	0.412214748	],
[	1.309016994	,	0.048943484	],
[	2	,	1	]];


function EuclideanDistance(x1,y1,x2,y2){
  return Math.sqrt( Math.pow((x1-x2),2) + Math.pow((y1-y2),2) );
}

function dist(){
  for (var i = 0; i < data.length; i++){
    var arr = [];
    for (var j = 0; j < data.length; j++){
      arr.push( EuclideanDistance(data[i][0], data[i][1],data[j][0], data[j][1]) );
    };
    distanceMatrix.push(arr);
  };
}

function totalDistance(tour){
  var tmpDist = 0.0;
  for (var j = 1; j < data.length; j++)
    tmpDist += parseFloat(distanceMatrix[tour[j-1]][tour[j]]);
  tmpDist += parseFloat(distanceMatrix[tour[data.length-1]][tour[0]]);
  return tmpDist;
}

// inclusive min,max
function getRndInteger(min, max) {
    return Math.floor(Math.random() * (max - min + 1) ) + min;
}

function getStringTour(tour){
 var locTxt="";
 for (var i = 0; i < tour.length-1; i++)
   locTxt += tour[i] + ",";
 locTxt += tour[tour.length-1];
 return locTxt;
}


function applyRandomMutationHC(){

dist();

var numberOfPasses = 1;
var currentSolution = [];
var currentSolutionDistance;
var newSolutionDistance;
var tmp;
var txt="";
var loc;
var loc2;
var bestTour;
var bestTourDistance;

// create a random permutation 
for (var i = 0; i < data.length; i++)
  currentSolution.push(i);
for (var i = 0; i < data.length-1; i++){
  loc = getRndInteger(i+1, data.length-1); // random location (i,maxLength)
  tmp = currentSolution[i];
  currentSolution[i] = currentSolution[loc];
  currentSolution[loc] = tmp;
}

currentSolutionDistance = totalDistance(currentSolution);  
bestTourDistance = currentSolutionDistance; 
bestTour = currentSolution.slice();

txt+="Initial solution: "+getStringTour(bestTour)+": "+currentSolutionDistance+"<p></p>";

for (var k = 0; k < numberOfPasses; k++){
	txt+="Pass#"+k+"<br/>";
	
	// applying hill climbing for one pass
	for (var i = 0; i < data.length; i++){

	  // MAKE MOVE: random swap forming a new solution from current solution
	  loc = getRndInteger(0, data.length-1); 
	  loc2 = getRndInteger(1, data.length-1); 
	  if (loc==loc2){ loc2 = loc2+1; if (loc2==data.length) loc2=0;}; 
	  tmp = currentSolution[loc];
	  currentSolution[loc] = currentSolution[loc2];
	  currentSolution[loc2] = tmp;
	  
	  newSolutionDistance = totalDistance(currentSolution);
	  
	  if (newSolutionDistance < bestTourDistance){ // improving move
		txt+= "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" +getStringTour(currentSolution)+": "+newSolutionDistance+"<br/>";  
		bestTour = currentSolution.slice();
		bestTourDistance = newSolutionDistance;
	  } else{ //swap back to the original configuration if the move is not an improving move
		txt+=  getStringTour(currentSolution)+": "+newSolutionDistance+"<br/>";
		tmp = currentSolution[loc2];
		currentSolution[loc2] = currentSolution[loc];
		currentSolution[loc] = tmp;
	  }
	}
	txt+="End of Pass#"+k + ". best tour length (travelling distance): "+ bestTourDistance+"<p></p>";
}

document.getElementById("demo").innerHTML = "Known optimal tour length for this TSP instance is ~5.87<p><p/>Number of RMHC passes: " + numberOfPasses +"<br/>Best tour found by RMHC: " + getStringTour(bestTour) +"<br/> Best tour length (travelling distance): "+ bestTourDistance +"<p></p>Searched States (Configurations, Solutions):<br/>"+ txt;

}

</script>
</head>

<body>

<h1>Exercise - Random Mutation Hill Climbing (RMHC)</h1>
<button type="button" onclick="applyRandomMutationHC()">Run the algorithm</button>
<p></p>
<img width="400" src="http://www.cs.nott.ac.uk/~pszeo/teaching/javaScript/G52AIM/circle5points.jpg"/>
<p id="demo">Apply random permutation hill climbing for a number of passes over a randomly created initial solution to the given TSP problem instance with 5 cities (Experiments are not repeatable). Any improving solution has a tab with a few spaces as a prefix. <br/>You can edit the JavaScript code in this HTML file for experimentation, e.g., you can change the number of passes (search for 'numberOfPasses') to try out different values.</p>

</body>
</html>